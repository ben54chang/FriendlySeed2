# 檔案總管系統

## 1. 系統架構

### 1.1 技術架構
- **後端框架**: ASP.NET Core 8.0 MVC
- **前端UI**: LTEAdmin 3.2 + Bootstrap 5
- **JavaScript庫**: jQuery, Bootstrap 5 Modal
- **認證方式**: Cookie Authentication
- **檔案操作**: System.IO (DirectoryInfo, FileInfo)
- **檔案上傳**: IFormFile (支援所有檔案類型，50MB限制)
- **檔案預覽**: 支援圖片和文字檔案

### 1.2 專案結構
```
FriendlySeed/
├── Areas/
│   └── Admin/
│       ├── Controllers/
│       │   └── FileSetupController.cs
│       └── Views/
│           └── FileSetup/
│               └── Index.cshtml
└── wwwroot/
    └── FileSetup/
        └── (檔案儲存目錄)
```

## 2. 功能需求

### 2.1 基本功能
- **目錄瀏覽**: 樹狀目錄結構顯示
- **檔案列表**: 顯示目錄下的檔案和資料夾
- **資料夾建立**: 建立新的資料夾
- **檔案建立**: 建立新的空白檔案
- **檔案上傳**: 上傳檔案到指定目錄
- **檔案下載**: 下載檔案
- **檔案預覽**: 預覽圖片和文字檔案

### 2.2 進階功能
- **重新命名**: 重新命名檔案和資料夾
- **搬移操作**: 搬移檔案和資料夾到其他目錄
- **複製操作**: 複製檔案和資料夾到其他目錄
- **刪除操作**: 刪除檔案和資料夾
- **即時更新**: AJAX 操作，無需重新載入頁面
- **錯誤處理**: 完整的錯誤處理和訊息提示

### 2.3 安全性控制
- **管理員認證**: 需要登入後台才能存取
- **路徑安全**: 防止目錄遍歷攻擊
- **檔案大小限制**: 50MB 上傳限制
- **CSRF 保護**: 所有操作都有 CSRF Token 驗證

## 3. 系統架構

### 3.1 檔案系統結構
```
wwwroot/FileSetup/
├── (根目錄)
├── 子目錄1/
│   ├── 檔案1.txt
│   └── 子目錄1-1/
└── 子目錄2/
    └── 檔案2.jpg
```

### 3.2 支援的檔案類型
| 檔案類型 | 副檔名 | 預覽支援 | 說明 |
|---------|--------|---------|------|
| 圖片檔案 | .jpg, .jpeg, .png, .gif, .bmp, .webp | ✅ | 直接顯示圖片 |
| 文字檔案 | .txt, .html, .css, .js, .json, .xml, .md, .csv, .log | ✅ | 顯示文字內容 |
| 其他檔案 | 所有其他類型 | ❌ | 僅支援下載 |

### 3.3 操作權限
- **讀取**: 瀏覽目錄和檔案
- **建立**: 建立新資料夾和檔案
- **上傳**: 上傳檔案
- **修改**: 重新命名檔案和資料夾
- **搬移**: 搬移檔案和資料夾
- **複製**: 複製檔案和資料夾
- **刪除**: 刪除檔案和資料夾

## 4. 使用者介面需求

### 4.1 後台路徑
- **主要頁面**: `localhost:8054/Admin/FileSetup`
- **認證要求**: 需要管理員登入

### 4.2 介面元件
- **UI框架**: LTEAdmin 3.2 + Bootstrap 5
- **佈局**: 左右分欄設計
- **左側**: 樹狀目錄結構
- **右側**: 檔案和資料夾列表
- **彈出視窗**: Bootstrap Modal 預覽功能

### 4.3 功能按鈕
- **新資料夾**: 建立新資料夾
- **新檔案**: 建立新檔案
- **上傳**: 上傳檔案
- **重新整理**: 重新載入目錄結構
- **下載**: 下載檔案
- **預覽**: 預覽檔案內容
- **重新命名**: 重新命名檔案/資料夾
- **搬移**: 搬移檔案/資料夾
- **複製**: 複製檔案/資料夾
- **刪除**: 刪除檔案/資料夾

## 5. API 端點

### 5.1 目錄操作
- **GET** `/Admin/FileSetup/Tree?id=#` - 取得樹狀目錄結構
- **GET** `/Admin/FileSetup/List?path=` - 取得目錄內容列表

### 5.2 檔案操作
- **POST** `/Admin/FileSetup/CreateFolder` - 建立資料夾
- **POST** `/Admin/FileSetup/CreateFile` - 建立檔案
- **POST** `/Admin/FileSetup/Upload` - 上傳檔案
- **GET** `/Admin/FileSetup/Download?path=` - 下載檔案
- **GET** `/Admin/FileSetup/Preview?path=` - 預覽檔案

### 5.3 管理操作
- **POST** `/Admin/FileSetup/Rename` - 重新命名
- **POST** `/Admin/FileSetup/Move` - 搬移檔案/資料夾
- **POST** `/Admin/FileSetup/Copy` - 複製檔案/資料夾
- **POST** `/Admin/FileSetup/Delete` - 刪除檔案/資料夾

## 6. 驗收項目

### 6.1 基本功能驗收
- [ ] **目錄瀏覽**
  - [ ] 樹狀目錄結構正確顯示
  - [ ] 點擊目錄節點正確切換路徑
  - [ ] 目錄展開/收合功能正常
  - [ ] 目錄層級正確顯示

- [ ] **檔案列表顯示**
  - [ ] 正確顯示目錄下的檔案和資料夾
  - [ ] 檔案圖示正確顯示 (資料夾/檔案)
  - [ ] 檔案大小正確顯示
  - [ ] 修改時間正確顯示
  - [ ] 操作按鈕正確顯示

- [ ] **資料夾建立功能**
  - [ ] 成功建立新資料夾
  - [ ] 資料夾名稱驗證正常
  - [ ] 重複名稱檢查正常
  - [ ] 建立後自動更新列表

- [ ] **檔案建立功能**
  - [ ] 成功建立新檔案
  - [ ] 檔案名稱驗證正常
  - [ ] 重複名稱檢查正常
  - [ ] 建立後自動更新列表

- [ ] **檔案上傳功能**
  - [ ] 成功上傳檔案
  - [ ] 檔案大小限制正常 (50MB)
  - [ ] 上傳後自動更新列表
  - [ ] 上傳失敗錯誤處理

### 6.2 進階功能驗收
- [ ] **檔案下載功能**
  - [ ] 成功下載檔案
  - [ ] 檔案名稱正確
  - [ ] 檔案內容完整
  - [ ] 下載失敗錯誤處理

- [ ] **檔案預覽功能**
  - [ ] 圖片檔案正確預覽
  - [ ] 文字檔案正確預覽
  - [ ] 不支援的檔案類型正確提示
  - [ ] Modal 預覽視窗正常運作

- [ ] **重新命名功能**
  - [ ] 成功重新命名檔案
  - [ ] 成功重新命名資料夾
  - [ ] 新名稱驗證正常
  - [ ] 重複名稱檢查正常
  - [ ] 重新命名後自動更新列表

- [ ] **搬移功能**
  - [ ] 成功搬移檔案
  - [ ] 成功搬移資料夾
  - [ ] 目的目錄驗證正常
  - [ ] 搬移後自動更新列表

- [ ] **複製功能**
  - [ ] 成功複製檔案
  - [ ] 成功複製資料夾 (包含子目錄)
  - [ ] 目的目錄驗證正常
  - [ ] 複製後自動更新列表

- [ ] **刪除功能**
  - [ ] 成功刪除檔案
  - [ ] 成功刪除資料夾 (包含子目錄)
  - [ ] 確認對話框正常顯示
  - [ ] 刪除後自動更新列表

### 6.3 使用者體驗驗收
- [ ] **介面響應性**
  - [ ] 所有操作使用 AJAX，無需重新載入頁面
  - [ ] 載入狀態正確顯示
  - [ ] 錯誤訊息正確顯示
  - [ ] 成功訊息正確顯示

- [ ] **操作便利性**
  - [ ] 按鈕工具提示正常顯示
  - [ ] 操作流程直觀易懂
  - [ ] 確認對話框適當顯示
  - [ ] 輸入驗證即時回饋

- [ ] **錯誤處理**
  - [ ] 網路錯誤正確處理
  - [ ] 檔案操作錯誤正確處理
  - [ ] 權限錯誤正確處理
  - [ ] 錯誤訊息清楚易懂

### 6.4 安全性驗收
- [ ] **權限控制**
  - [ ] 未登入無法存取頁面
  - [ ] 登入後正常存取功能
  - [ ] 操作權限正確

- [ ] **檔案安全**
  - [ ] 防止目錄遍歷攻擊
  - [ ] 檔案路徑安全驗證
  - [ ] 檔案大小限制正常
  - [ ] CSRF Token 驗證正常

- [ ] **資料安全**
  - [ ] 檔案操作日誌記錄
  - [ ] 錯誤資訊不洩露敏感資料
  - [ ] 檔案存取權限控制

## 7. 測試案例

### 7.1 功能測試
1. **目錄操作測試**
   - 建立多層級資料夾
   - 瀏覽不同層級的目錄
   - 測試目錄展開/收合

2. **檔案操作測試**
   - 上傳各種類型的檔案
   - 建立文字檔案
   - 測試檔案預覽功能

3. **管理操作測試**
   - 重新命名檔案和資料夾
   - 搬移檔案到不同目錄
   - 複製檔案和資料夾
   - 刪除檔案和資料夾

### 7.2 介面測試
1. **響應式測試**
   - 不同螢幕尺寸的顯示
   - 按鈕和連結的正常運作
   - Modal 視窗的正常顯示

2. **使用者體驗測試**
   - 操作流程的順暢性
   - 錯誤訊息的清楚性
   - 載入狀態的適當性

### 7.3 安全性測試
1. **權限測試**
   - 未登入存取測試
   - 登入後功能測試
   - 操作權限測試

2. **檔案安全測試**
   - 目錄遍歷攻擊測試
   - 檔案路徑安全測試
   - 檔案大小限制測試

## 8. 部署說明

### 8.1 環境需求
- .NET 8.0 Runtime
- IIS 或 Kestrel
- 檔案系統寫入權限

### 8.2 設定檔
- `Program.cs`: 服務註冊和中介軟體設定
- `appsettings.json`: 應用程式設定

### 8.3 檔案權限
- `wwwroot/FileSetup/`: 檔案儲存目錄需要寫入權限
- 應用程式需要讀取和寫入檔案系統的權限

### 8.4 注意事項
- 檔案總管僅限管理員使用
- 建議定期備份重要檔案
- 注意檔案儲存空間的使用情況
- 建議設定檔案大小和數量限制
