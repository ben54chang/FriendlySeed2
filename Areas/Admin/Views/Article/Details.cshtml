@model FriendlySeed.Models.Article

@{
    ViewData["Title"] = "文章詳情";
}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-eye"></i> 文章詳情
                </h3>
                <div class="card-tools">
                    <a href="@Url.Action("Index")" class="btn btn-secondary btn-sm">
                        <i class="fas fa-arrow-left"></i> 返回列表
                    </a>
                    <a href="@Url.Action("Edit", new { id = Model.ID })" class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i> 編輯
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h2 class="mb-3">@Html.Raw(System.Web.HttpUtility.HtmlDecode(Model.Title))</h2>
                        
                        @if (!string.IsNullOrEmpty(Model.Alias))
                        {
                            <p class="text-muted mb-3">
                                <strong>代稱：</strong> @Model.Alias
                            </p>
                        }
                        
                        <div class="mb-3">
                            <span class="badge bg-primary me-2">@Model.Category?.ArticleCategoryName</span>
                            @if (Model.IsTop)
                            {
                                <span class="badge bg-warning me-2">
                                    <i class="fas fa-star"></i> 置頂
                                </span>
                            }
                            <span class="badge @(Model.IsActive ? "bg-success" : "bg-danger")">
                                @(Model.IsActive ? "啟用" : "停用")
                            </span>
                        </div>
                        
                        <div class="mb-4">
                            <strong>作者：</strong> @Model.Author<br>
                            <strong>發布時間：</strong> @(Model.PublishTime?.ToString("yyyy-MM-dd HH:mm") ?? "未發布")<br>
                            <strong>建立時間：</strong> @Model.CreatedTime.ToString("yyyy-MM-dd HH:mm")<br>
                            <strong>更新時間：</strong> @Model.UpdatedTime.ToString("yyyy-MM-dd HH:mm")<br>
                            <strong>排序：</strong> @Model.SortOrder
                        </div>
                        
                        @if (!string.IsNullOrEmpty(Model.Keywords))
                        {
                            <div class="mb-4">
                                <strong>關鍵字：</strong>
                                <div class="mt-2">
                                    @foreach (var keyword in Model.Keywords.Split(','))
                                    {
                                        <span class="badge bg-light text-dark me-1">@keyword.Trim()</span>
                                    }
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            <div class="mb-4">
                                <strong>內容：</strong>
                                <div class="mt-2 p-3 border rounded bg-light">
                                    @Html.Raw(Model.Description)
                                </div>
                            </div>
                        }
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">檔案資訊</h5>
                            </div>
                            <div class="card-body">
                                @if (!string.IsNullOrEmpty(Model.FilePath))
                                {
                                    <div class="text-center">
                                        <i class="fas fa-file-alt fa-3x text-primary mb-3"></i>
                                        <p class="mb-2">
                                            <strong>檔案名稱：</strong><br>
                                            @Model.FilePath.Split('/').Last()
                                        </p>
                                        <a href="@Model.FilePath" target="_blank" class="btn btn-primary btn-sm">
                                            <i class="fas fa-download"></i> 下載檔案
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center text-muted">
                                        <i class="fas fa-file-alt fa-3x mb-3"></i>
                                        <p>無附加檔案</p>
                                    </div>
                                }
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5 class="card-title mb-0">操作</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <a href="@Url.Action("Edit", new { id = Model.ID })" class="btn btn-primary">
                                        <i class="fas fa-edit"></i> 編輯文章
                                    </a>
                                    
                                    <button type="button" class="btn btn-warning" onclick="toggleStatus(@Model.ID)">
                                        <i class="fas fa-toggle-@(Model.IsActive ? "on" : "off")"></i> 
                                        @(Model.IsActive ? "停用" : "啟用")
                                    </button>
                                    
                                    <button type="button" class="btn btn-danger" onclick="deleteArticle(@Model.ID, '@Html.Raw(System.Web.HttpUtility.JavaScriptStringEncode(Model.Title))')">
                                        <i class="fas fa-trash"></i> 刪除文章
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    
    <script>
        function toggleStatus(articleId) {
            $.ajax({
                url: '@Url.Action("ToggleStatus")',
                type: 'POST',
                data: { id: articleId },
                success: function(response) {
                    if (response.success) {
                        toastr.success(response.message);
                        location.reload();
                    } else {
                        toastr.error(response.message);
                    }
                },
                error: function() {
                    toastr.error('操作失敗，請稍後再試');
                }
            });
        }

        function deleteArticle(articleId, title) {
            if (confirm('確定要刪除文章「' + title + '」嗎？')) {
                $.ajax({
                    url: '@Url.Action("Delete")',
                    type: 'POST',
                    data: { id: articleId },
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message);
                            window.location.href = '@Url.Action("Index")';
                        } else {
                            toastr.error(response.message);
                        }
                    },
                    error: function() {
                        toastr.error('刪除失敗，請稍後再試');
                    }
                });
            }
        }
    </script>
}
