# 教師管理系統

## 1. 系統架構

### 1.1 技術架構
- **後端框架**: ASP.NET Core 8.0 MVC
- **資料庫**: Microsoft SQL Server
- **ORM**: Dapper
- **前端UI**: LTEAdmin 3.2 + Bootstrap 5
- **JavaScript庫**: jQuery, DataTables, Toastr, SweetAlert2
- **認證方式**: Cookie Authentication
- **密碼驗證**: 密碼確認欄位一致性檢查

### 1.2 專案結構
```
FriendlySeed/
├── Areas/
│   └── Admin/
│       ├── Controllers/
│       │   └── TeacherController.cs
│       └── Views/
│           └── Teacher/
│               └── Index.cshtml
├── Models/
│   └── Teacher.cs
├── Services/
│   ├── ITeacherService.cs
│   └── TeacherService.cs
└── wwwroot/
    └── js/
        └── admin.js
```

## 2. 功能需求

### 2.1 基本功能
- **教師列表**: 顯示所有教師，支援分頁、搜尋、排序
- **教師新增**: 透過 Modal 彈出視窗新增教師
- **教師編輯**: 透過 Modal 彈出視窗編輯教師
- **教師刪除**: AJAX 刪除教師
- **狀態切換**: 啟用/停用教師狀態
- **密碼管理**: 密碼與確認密碼一致性檢查

### 2.2 進階功能
- **Excel 匯出**: 匯出教師列表為 Excel 檔案
- **即時驗證**: 密碼一致性即時檢查
- **訊息提示**: 使用 Toastr 顯示操作結果
- **表單驗證**: 前端和後端雙重驗證

### 2.3 權限控制
- **管理員認證**: 需要登入後台才能存取
- **操作記錄**: 記錄建立時間、更新時間
- **狀態管理**: 支援教師啟用/停用狀態

## 3. 資料表結構

### 3.1 Teacher 資料表
```sql
CREATE TABLE Teacher (
    ID INT IDENTITY(1,1) PRIMARY KEY,                    -- 教師ID
    Email NVARCHAR(255) NOT NULL,                         -- 電子信箱
    Name NVARCHAR(100) NOT NULL,                          -- 姓名
    BirthDate DATE NULL,                                  -- 生日
    Gender NVARCHAR(10) NULL,                             -- 性別
    Organization NVARCHAR(200) NULL,                     -- 服務單位
    Position NVARCHAR(100) NULL,                          -- 職稱
    City NVARCHAR(50) NULL,                              -- 縣市
    District NVARCHAR(50) NULL,                           -- 鄉鎮市區
    Password NVARCHAR(255) NOT NULL,                      -- 密碼
    CreatedTime DATETIME2 DEFAULT GETDATE(),             -- 建立時間
    UpdatedTime DATETIME2 DEFAULT GETDATE(),             -- 更新時間
    IsActive BIT DEFAULT 1                               -- 是否啟用
);
```

### 3.2 欄位說明
| 欄位名稱 | 資料類型 | 是否必填 | 預設值 | 說明 |
|---------|---------|---------|--------|------|
| ID | INT | 是 | IDENTITY(1,1) | 主鍵，自動遞增 |
| Email | NVARCHAR(255) | 是 | - | 電子信箱 |
| Name | NVARCHAR(100) | 是 | - | 教師姓名 |
| BirthDate | DATE | 否 | NULL | 生日 |
| Gender | NVARCHAR(10) | 否 | NULL | 性別 |
| Organization | NVARCHAR(200) | 否 | NULL | 服務單位 |
| Position | NVARCHAR(100) | 否 | NULL | 職稱 |
| City | NVARCHAR(50) | 否 | NULL | 縣市 |
| District | NVARCHAR(50) | 否 | NULL | 鄉鎮市區 |
| Password | NVARCHAR(255) | 是 | - | 密碼 |
| CreatedTime | DATETIME2 | 否 | GETDATE() | 建立時間 |
| UpdatedTime | DATETIME2 | 否 | GETDATE() | 更新時間 |
| IsActive | BIT | 否 | 1 | 是否啟用 |

## 4. 使用者介面需求

### 4.1 後台路徑
- **主要頁面**: `localhost:8054/Admin/Teacher`
- **認證要求**: 需要管理員登入

### 4.2 介面元件
- **UI框架**: LTEAdmin 3.2 + Bootstrap 5
- **資料表格**: DataTables (繁體中文介面)
- **彈出視窗**: Bootstrap Modal
- **訊息提示**: Toastr
- **確認對話框**: SweetAlert2

### 4.3 功能按鈕
- **新增按鈕**: 開啟 Modal 新增教師
- **編輯按鈕**: 開啟 Modal 編輯教師
- **刪除按鈕**: AJAX 刪除教師
- **狀態切換**: 啟用/停用教師
- **Excel匯出**: 匯出教師列表

## 5. 驗收項目

### 5.1 基本功能驗收
- [ ] **教師列表顯示**
  - [ ] 正確顯示所有教師資料
  - [ ] 支援分頁功能 (每頁25筆)
  - [ ] 支援搜尋功能
  - [ ] 支援欄位排序
  - [ ] 顯示繁體中文介面

- [ ] **教師新增功能**
  - [ ] Modal 彈出視窗正常開啟
  - [ ] 表單驗證正常運作
  - [ ] 必填欄位驗證 (電子信箱、姓名、密碼)
  - [ ] 密碼一致性驗證
  - [ ] 成功新增後顯示成功訊息
  - [ ] 新增後自動重新載入列表

- [ ] **教師編輯功能**
  - [ ] Modal 彈出視窗正常開啟
  - [ ] 正確載入現有資料
  - [ ] 表單驗證正常運作
  - [ ] 密碼一致性驗證
  - [ ] 成功更新後顯示成功訊息
  - [ ] 更新後自動重新載入列表

- [ ] **教師刪除功能**
  - [ ] 確認對話框正常顯示
  - [ ] 成功刪除後顯示成功訊息
  - [ ] 刪除後自動重新載入列表

### 5.2 進階功能驗收
- [ ] **密碼管理功能**
  - [ ] 密碼與確認密碼欄位顯示
  - [ ] 即時密碼一致性檢查
  - [ ] 密碼不一致時顯示錯誤提示
  - [ ] 表單提交前密碼驗證
  - [ ] 編輯時密碼欄位正確載入

- [ ] **Excel 匯出功能**
  - [ ] 匯出按鈕正常顯示
  - [ ] 匯出檔案包含正確資料
  - [ ] 匯出欄位正確 (排除操作欄位)
  - [ ] 匯出檔案名稱正確

### 5.3 使用者體驗驗收
- [ ] **介面響應性**
  - [ ] Modal 點擊背景不關閉
  - [ ] Modal 右上角關閉圖示正常
  - [ ] 載入狀態正確顯示
  - [ ] 錯誤訊息正確顯示

- [ ] **訊息提示**
  - [ ] 成功操作顯示綠色 Toastr
  - [ ] 錯誤操作顯示紅色 Toastr
  - [ ] 訊息內容正確
  - [ ] 訊息自動消失

- [ ] **資料驗證**
  - [ ] 前端即時驗證
  - [ ] 後端 ModelState 驗證
  - [ ] 錯誤訊息正確顯示
  - [ ] 必填欄位標示清楚

### 5.4 效能驗收
- [ ] **載入效能**
  - [ ] 頁面載入時間 < 3秒
  - [ ] DataTable 初始化正常
  - [ ] AJAX 請求回應時間 < 2秒

- [ ] **資料處理**
  - [ ] 大量資料分頁正常
  - [ ] 搜尋功能效能良好
  - [ ] 排序功能正常運作

### 5.5 安全性驗收
- [ ] **權限控制**
  - [ ] 未登入無法存取頁面
  - [ ] 登入後正常存取功能
  - [ ] 操作權限正確

- [ ] **資料安全**
  - [ ] CSRF Token 驗證
  - [ ] 密碼安全性檢查
  - [ ] SQL Injection 防護
  - [ ] XSS 防護

## 6. 測試案例

### 6.1 功能測試
1. **新增教師測試**
   - 輸入完整資料新增教師
   - 輸入不完整資料測試驗證
   - 密碼一致性測試
   - 必填欄位測試

2. **編輯教師測試**
   - 修改教師姓名
   - 修改電子信箱
   - 修改密碼
   - 修改服務單位

3. **刪除教師測試**
   - 刪除單一教師
   - 確認對話框測試
   - 刪除後資料確認

### 6.2 介面測試
1. **Modal 測試**
   - 開啟/關閉 Modal
   - Modal 內容載入
   - 表單驗證顯示

2. **DataTable 測試**
   - 分頁功能
   - 搜尋功能
   - 排序功能
   - Excel 匯出

### 6.3 錯誤處理測試
1. **網路錯誤測試**
   - 網路中斷情況
   - 伺服器錯誤處理
   - 超時處理

2. **資料驗證測試**
   - 必填欄位測試
   - 字元長度測試
   - 密碼一致性測試
   - 電子信箱格式測試

## 7. 部署說明

### 7.1 環境需求
- .NET 8.0 Runtime
- Microsoft SQL Server
- IIS 或 Kestrel

### 7.2 設定檔
- `appsettings.json`: 資料庫連線字串
- `Program.cs`: 服務註冊和中介軟體設定

### 7.3 資料庫設定
- 確保 Teacher 資料表已建立
- 確認所有欄位資料類型正確
- 檢查預設值和約束條件

## 8. API 端點

### 8.1 Controller 方法
- `GET /Admin/Teacher` - 顯示教師列表
- `GET /Admin/Teacher/GetTeacher?id={id}` - 取得單一教師資料
- `POST /Admin/Teacher/Create` - 新增教師
- `POST /Admin/Teacher/Edit` - 編輯教師
- `POST /Admin/Teacher/ToggleStatus` - 切換教師狀態
- `POST /Admin/Teacher/Delete` - 刪除教師

### 8.2 回應格式
```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... }
}
```

## 9. 特殊功能說明

### 9.1 密碼確認功能
- **即時檢查**: 輸入密碼時即時檢查一致性
- **視覺回饋**: 不一致時顯示紅色邊框和錯誤訊息
- **表單驗證**: 提交前再次檢查密碼一致性
- **編輯模式**: 載入現有密碼到兩個欄位

### 9.2 UI 一致性
- **與 Article 頁面完全一致**: 相同的 UI 元件和功能
- **Alert 訊息**: 成功/錯誤訊息顯示
- **按鈕樣式**: 統一的按鈕設計和圖示
- **Modal 行為**: 相同的 Modal 操作體驗
